<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>海大教室借用平台</title>
  <link rel="stylesheet" href="CSS/Home.css">
</head>

<body>

  <div class="container">
    <img src="image/classroom cover.png">

    <div class="overlay">

      <div class="top-row">
        <p>海大教室借用平台</p>
        <button id="login-signup">登入/註冊</button>
      </div>

      <div class="bottom-row">
        <p>透過海大教室借用平台，便捷地尋找理想教室，簡單預訂，讓借用流程輕鬆便捷，提高使用效率，滿足不同需求。
        </p>
        <div class="box">
          <div id="chooseText" class="chooseText">

            <button onclick="showDateform()">點擊這選擇查詢日期</button>
          </div>

          <div id="choosedate" class="date">
            <input type="date" id="datePicker" name="datePicker" onchange="updateLabel()">
            <span>
              <button class="verification-button"><img src="image/queryIcon.png"></button>
            </span>
          </div>
        </div>
      </div>

    </div>


  </div>

  <script>
    const now = new Date();

    const datePicker = document.getElementById("datePicker");
    const queryButton = document.querySelector(".verification-button");
    queryButton.addEventListener("click", searchDate, false);

    let chooseText = document.getElementById("chooseText");
    let choosedate = document.getElementById("choosedate");

    datePicker.value = dateToString(now);
    datePicker.min = dateToString(now);
    datePicker.max = add30(now);

    let selectedDate = datePicker.value;

    function dateToString(date) {
      let temp = new Date(date);
      //格式化日，如果小於9，前面補0
      let day = ("0" + temp.getDate()).slice(-2);
      //格式化月，如果小於9，前面補0
      let month = ("0" + (temp.getMonth() + 1)).slice(-2);
      //拼裝完整日期格式
      let result = temp.getFullYear() + "-" + (month) + "-" + (day);
      return result;
    }

    function add30(date) {
      let resultDate = new Date(date);
      resultDate.setDate(resultDate.getDate() + 30);
      return dateToString(resultDate);
    }

    //獲取使用者身分
    let user = {
      username: "",
      useraccount: "",
      email: "",
      phone: null
    };
    fetch("獲取身分資訊.php", {method: 'POST'})
    .then(response => response.json())
    .then(data => {
      //已登入
      if(data.error === undefined) {
        user = data;
        document.getElementById("login-signup").innerHTML = "<img src='image/usericon.png' class='usericon'>" + user.username;
        document.getElementById("login-signup").addEventListener("click", function (event) {
          window.location.href = "使用者介面.html";
        }, false);
      }
      //未登入
      else {
        document.getElementById("login-signup").addEventListener("click", function (event) {
          window.location.href = "選擇登入身分.html";
        }, false);
      }
    });

    function updateLabel() {
      selectedDate = datePicker.value;
    }

    function searchDate() {
      const formdata = new FormData();
      formdata.append("date", selectedDate);

      fetch("搜尋日期.php", {
        method: 'POST',
        body: formdata
      });
      window.location.href = "index.html";
    }

    function showDateform() {
      chooseText.classList.add("delete");
      choosedate.classList.add("show");
      
    }
  </script>
</body>

</html>